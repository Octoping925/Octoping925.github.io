---
title: "스타포스 강화 시뮬레이터"
date: 2020-02-07 15:14:01 -0400
categories: Maple
---
<html>
<body>
<p>
  강화 템 렙제
  <br>
  <input name="item_level" type="radio" value="lev_140">140제
  <input name="item_level" type="radio" value="lev_150">150제
  <input name="item_level" type="radio" value="lev_160">160제
  <input name="item_level" type="radio" value="lev_200">200제
</p>

<br>
<p>
  강화 시작 레벨 <input id = "start_level" max="25" min="0" type="number">
  <br>
  강화 목표 레벨 <input id = "goal_level" max="25" min="0" type="number">
</p>
<p>
  스타캐치 수행 여부 <input id = "useStarCatch" type="checkbox">
  <br>
  파괴방지 시행 여부 (12~16레벨) <input id = "useDestroyBlock" type="checkbox">
</p>
<p> 노작 값 (1000만이면 1000, 1억이면 10000으로 적어주세요) <input id = "nojak" type="number"></p>

<script>
  const opportunity = [[95, 0], [90, 0], [85, 0], [85, 0], [80, 0], [75, 0], [70, 0], [65, 0],
    [60, 0], [55, 0], [50, 0], [45, 0], [40, 0.6], [35, 1.3], [30, 1.4], [30, 2.1], [30, 2.1],
    [30, 2.1], [30, 2.8], [30, 2.8], [30, 7], [30, 7], [3, 19.4], [2, 29.4], [1, 39.6]];
  let price;

  const CONSTANTS = {
    SUCCESS: 0,
    FAIL: 1,
    DESTROY: 2,
  }

function output()
{
  const lev_choose = document.getElementsByName("item_level");
  if (lev_choose[0].checked) price = [11, 22, 33, 44, 54.9, 65.9, 76.9, 87.9, 98.8, 109.8, 444.8, 562.5, 698.2, 852.9, 1027.5, 2446.2, 2881.2, 3362, 3890.4, 4468.3, 5097.4, 5779.6, 6516.6, 7310.2, 8162];
  else if (lev_choose[1].checked) price = [13.6, 27.1, 40.6, 54.1, 67.6, 81.1, 94.6, 108.1, 121.6, 135.1, 547, 691.9, 858.8, 1049, 1263.8, 3008.7, 3543.7, 4135.1, 4785, 5495.8, 6269.6, 7108.7, 8015.2, 8991.2, 10038.9];
  else if (lev_choose[2].checked) price = [16.4, 32.8, 49.2, 65.6, 82, 98.4, 114.7, 131.1, 147.5, 163.9, 663.9, 839.7, 1042.2, 1273.1, 1533.8, 3651.4, 4300.8, 5018.5, 5807.2, 6669.8, 7609, 8627.3, 9727.4, 10912, 12183.4];
  else if (lev_choose[3].checked) price = [32.1, 64.1, 128.1, 160.1, 192.1, 224.1, 256.1, 288.1, 320.1, 1296.65, 1640.01, 2035.63, 2486.53, 2995.65, 7131.65, 8399.96, 9801.67, 11342.23, 13027, 14861.24, 16850.15, 18998.86, 21312.4, 23795.77];

  const startLevel = Number(document.getElementById("start_level").value);
  const goalLevel = Number(document.getElementById("goal_level").value);
  const starcatchBonus = document.getElementById("useStarCatch").checked ? 4.5 : 0;
  const destroyDefense = {
    useYN: document.getElementById("useDestroyBlock").checked,
    isIn: (x) => this.useYN && 12 <= x && x <= 16,
  }
  const nojakPrice = Number(document.getElementById("nojak").value);


  // document.getElementById("avgmeso").innerHTML = "로딩 중";
  // document.getElementById("avgbroke").innerHTML = "로딩 중";

  class Item {
    star;
    meso;
    failCnt;
    destroyCnt;

    constructor() {
      this.star = startLevel;
      this.meso = 0;
      this.failCnt = 0;
      this.destroyCnt = 0;
    }

    doReinforce() {
      this.meso += this.getReinforcePrice();
      const result = this.getReinforceResult();

      switch(result) {
        case CONSTANTS.SUCCESS:
          this.star++;
          this.failCnt = 0;
          break;

        case CONSTANTS.DESTROY:
          this.star = 12;
          this.meso += nojakPrice;
          this.destroyCnt++;
          this.failCnt = 0;
          break;

        case CONSTANTS.FAIL:
          if (this.star > 10 && this.star % 5 !== 0) { // 별 떨어지는 조건
            this.star--;
            this.failCnt++;
          }
          break;
      }
    }

    getReinforcePrice() {
      // 파괴방지시 가격 2배
      if (destroyDefense.isIn(this.star)) return price[this.star] * 2;
      else return price[this.star];
    }

    getReinforceResult() {
      const opp = Math.random() * 100;
      const successOpp = opportunity[this.star][0] + starcatchBonus;
      const destroyOpp = opportunity[this.star][1];

      if (opp < successOpp || this.failCnt === 2) {
        return CONSTANTS.SUCCESS;
      }
      else if (opp > 100 - destroyOpp && !destroyDefense.isIn(this.star)) {
        return CONSTANTS.DESTROY;
      }
      else {
        return CONSTANTS.FAIL;
      }
    }
  }

  let totalMeso = 0;
  let totalDestroyedCnt = 0
  const tryCnt = 1000;

  for(let i = 0; i < tryCnt; ++i) {
    const cur = new Item();

    while (cur.star < goalLevel) {
      cur.doReinforce();
    }

    totalMeso += cur.meso;
    totalDestroyedCnt += cur.destroyCnt;
  }

  document.getElementById("averageMeso").innerHTML = parseInt(totalMeso / tryCnt * 10000);
  document.getElementById("averageBrokeCnt").innerHTML = (totalDestroyedCnt / tryCnt).toFixed(2);

  const avgMesoStr = `${parseInt(totalMeso / tryCnt / 10000)}억 ${parseInt(totalMeso / tryCnt) % 10000}만 ${parseInt(totalMeso / tryCnt * 10000 % 10000)} 메소`;
  document.getElementById("averageMeso").innerHTML = avgMesoStr;
}
</script>

<input onclick="output()" type="button" value="계산">

<br><br>
<p>
  평균 필요 메소: <span id="averageMeso"></span>
</p>
<p>
  평균 장비 파괴 횟수: <span id="averageBrokeCnt"> X </span>
</p>

<p>
  <a href = "https://www.google.com"> 멋진 사람은 여기로 </a>
</p>

</body>
</html>

<br>
2020년 04월 21일 6시 10분<br>
140, 150, 160제 스타포스 추가<br>
<br>
2022년 07월 08일<br>
코드 리팩토링<br>
